# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара

```
interface ICard {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
```

Заказ

```
interface IOrder {
    payment: string;
    email: string;
    phone: string;
    address: string;
    total: number;
    items: string[];
}
```

Ответ с сервера об успешном оформлении заказа

```
interface IOrderSuccess {
    id: string;
    total: number;
}
```

Корзина

```
interface IBasket {
    items: string[];
    total: number;
}
```

Тип данных для формы способа оплаты и адреса доставки

```
type TCheckOut = Pick<IOrder, 'payment' | 'address'>
```

Тип данных для формы контактов

```
type TContacts = Pick<IOrder, 'email' | 'phone'>
```

Тип данных для валидации формы

```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```

Интерфейс объекта с обработчиком события клика

```
interface IActions {
    onClick: (event: MouseEvent) => void;
}
```


## Архитектура приложения

Код разделён на слои, согласно MVP:
- слой отображения отвечает за отображение данных на странице
- слой данных отвечает за их хранение и изменение
- презентер отвечает за связь между слоем отображения и слоем данных

### Базовый код

#### Класс Api
Содержит базовую логику отправки запросов. В конструктор передаётся базовый адрес сервера и опциональный объект с заголовками запроса.

Методы:
- `get` - выполяет GET запрос на переданный эндпоинт и возвращает промис с объектом
- `post` - принимает объект с данными, которые будут отправлены в JSON в теле запроса, и отправялет эти данные на эндпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод может быть переопределён заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:
- `on` - подписка на события
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой иницициализируется требуемое в параметрах событие

#### Класс Component
Базовый абстрактный класс для работы с DOM-элементами. Содержит общие для дочерних классов методы:
- `toggleClass(element: HTMLElement, className: string, force?: boolean)` - переключает класс элемента
- `setDisabled(element: HTMLElement, state: boolean)` - включает или отключает у элемента атрибут disabled
- `setText(element: HTMLElement, value: unknown)` - устанавливает текст
- `setImage(element: HTMLImageElement, src: string, alt?: string)` - устанавливает изображение с alt-текстом
- `render(data?: Partial<T>): HTMLElement` - возвращает DOM-элемент для дальнейшего отображения 

Конструктор принимает в качестве параметра:
- `container: HTMLElement` - корневой элемент, содержащий разметку для рендеринга

#### Класс Model
Базовый абстрактный класс для создания модели данных. Предоставляет метод для вызова обрабочика событий:
- `emitChanges(event: string, payload?: object)` - сообщает обработчику о событии event и передаёт объект payload, если требуется. 


### Слой данных

#### Класс ShopAPI
Класс наследуется от базового класса Api и предназначен для работы с сервером.

Конструктор класса принимает:
- `cdn: string` - url-адрес для получения изображений
- `baseUrl: string` - url-адрес для получения информации о товарах

Методы класса:
- `getCardList(): Promise<ICard[]>` - выполняет GET-запрос на сервер и возвращает список товаров
- `postOrder(order: IOrder): Promise<IOrderSuccess>` - выполняет POST-запрос с информацией о заказе и возвращяет результат выполнения 

#### Класс AppState
Класс наследуется от базового класса Model и отвечает за логику работы с данными, а также управлением состояния приложения.

Поля класса:
- `cards: ICard[]` - список товаров
- `preview: string | null` - карточка товара, выбранная для просмотра
- `basket: IBasket` - список товаров в корзине и общая сумма заказа
- `order: IOrder` - информация о заказе
- `formErrors` - ошибки в полях форм заказа

Методы класса:
- `setCatalog(items: ICard[])` - устанавливает список товаров и генерирует событие 'cards:change'
- `setPreview(item: ICard)` - устанаваливает ID карточки товара для предварительного просмотра и генерирует событие 'preview:changed'
- `addCardToBasket(item: ICard)` - добавляет товар в корзину, увеличивает сумму заказа на стоимость товара и генерирует событие 'basket:change'
- `removeCardFromBasket(item: ICard)` - удалет товар из корзины, уменьшает сумму заказа на стоимость товара и генерирует событие 'basket:change'
- `inBasket(item: ICard)` - вовзращает ID карточки товара, добавленной в корзину
- `clearBasket()` - очищает список товаров в корзине, обнуляет сумму заказа и генерирует событие 'basket:change'
- `setOrderField(field: keyof (TCheckOut & TContacts), value: string)` - устанавливает значения полей в объект заказа и если форма заполнена без ошибок, передаёт из корзины в заказ его итоговую сумму и список товаров.
- `validateOrder()` - проверяет на заполнение поля заказа и генерирует событие 'formErrors:change'. Возвращает true, если форма прошла валидацию.

### Слой отображения

#### Класс Modal
Класс наследуется от базового класса Component и отвечает за отображения контента в модальном окне.
У каждого контента есть свой шаблон. 
Контент передаётся методу `render`, как параметр.

Поля класса
- `_closeButton: HTMLElement` - кнопка закрытия модального окна
- `_content: HTMLElement` - блок для контента модального окна

Конструктор класса принимает два параметра:
- `container: HTMLElement` - контейнер модального окна
- `events: IEvents` - брокер событий

Методы:
- `open(): void` - открыть модальное окно
- `close(): void` - закрыть модальное окно
- `render(data: HTMLElement): HTMLElement` - рендер контента для отображения в модальном окне

#### Класс Form
Класс содержит общие для дочерних классов Order и Contacts методы.

Поля класса:
- `_submit: HTMLButtonElement` - элемент кнопки отправки формы
- `_errors: HTMLElement` - элемент для вывода ошибок валидации

Конструктор класса принимает два параметра:
- `container: HTMLFormElement` - элемент с формой
- `events: IEvents` - брокер событий

Методы класса:
- `onInputChange(field: keyof T, value: string)` - генерирует событие об изменении поля формы
- `valid(value: boolean)` - включает или отключает кнопку отправки формы 
- `errors(value: string)` - устанавливает текст об ошибках валидации
- `render(state: Partial<T> & IFormState)` - рендерит состояние формы и возвращает её

#### Класс Card
Класс Card наследуется от класса Component и отвечает за отображение:
- в галерее товаров на главной странице
- в модальном окне с подробной информацией
- в списке товаров в корзине

Поля класса:
- `_description: HTMLElement` - элемент описания товара
- `_image: HTMLImageElement` - элемент изображения товара
- `_title: HTMLElement` - элемент названия товара
- `_price: HTMLElement` - элемент стоимости товара
- `_button?: HTMLButtonElement` - элемент кнопки действия на карточке товара
- `categoryColors = <Record<string, string>>` - категории товаров и соответствующие им классы
- `_category: HTMLElement` - элемент ддля отображения категории товара

Конструктор класса принимает два параметра:
- `container: HTMLElement` - шаблон карточки 
- `actions?: IActions` - обработчик клика

Методы - сеттеры для заполнения полей класса.


#### Класс Basket
Класс Basket наследуется от класса Component и отвечает за отображение корзины.

Поля:
- `_items: HTMLElement` - корневой элемент списка товаров в корзине
- `_total: number` - элемент для отображения общей стоимости товаров в корзине
- `_button: HTMLElement` - кнопка "Оформить"

Конструктор класса принимает два параметра:
- `container: HTMLElement` - шаблон корзины 
- `events: IEvents` - брокер событий

Методы - сеттеры для заполнения полей класса.


#### Класс Order
Класс Order расширяет класс Form своими индивидуальными методами. 
Первый шаг оформления товара. Отображает форму в модальном окне.
Отображает элементы для указания способы оплаты и адреса доставки.

Поля класса:
- `_paymentCard` - элемент кнопки выбра способа оплаты "Онлайн"
- `_paymentCash` - элемент кнопки выбра способа оплаты "При получении"

Конструктор класса принимает два параметра:
- `container: HTMLElement` - шаблон формы #order
- `events: IEvents` - брокер событий

Методы - сеттеры для заполнения полей формы.


#### Класс Contacts
Класс Contacts расширяет класс Form своими индивидуальными методами.
Второй шаг оформления товара. Отображает форму в модальном окне.
Отображает инпуты для указания email и телефона.

Конструктор класса принимает два параметра:
- `container: HTMLElement` - контейнер, в котором будет отображаться контент
- `events: IEvents` - брокер событий

Методы - сеттеры для заполнения полей формы.


#### Класс Success
Класс Success наследуется от класса Component и отвечает за отображение информации об оформлении заказа.

Поля:
- `_total: HTMLElement` - элемент для отобращения суммы заказа
- `_close: HTMLButtonElement` - кнопка "За новыми покупками!"

Конструктор принимает два параметра:
- `container: HTMLElement` - контейнер, в котором будет отображаться контент
- `events: IEvents` - брокер событий

Методы - сеттер для заполнения поля total.


#### Класс Page
Класс Page наследуется от класса Component и отвечает за отображение на главной странице списка товаров, счётчика количества товаров в корзине и иконки корзины, слушающей клик.

Поля класса:
- `_gallery: HTMLElement` - элемент для отображения списка товаров
- `_basket: HTMLElement` - элемент с иконкой корзины, при клике на которую открывается модальное окно с содержимым корзины
- `_counter: HTMLElement` - элемент счётчика товаров в корзине 
- `_wrapper: HTMLElement` - элемент обёртки страницы, который будем блокировать при открытии модального окна

Конструктор класса принимает два параметра:
- `container: HTMLElement` - контейнер, в котором будет отображаться контент
- `events: IEvents` - брокер событий

Методы:
- `set counter(value: number)` - устанавливает количество товаров в счётчик товаров корзине
- `set gallery(items: HTMLElement[])` - устанавливает список товаров
- `locked(value: boolean)` - добавляет или убирает класс 'page__wrapper_locked' блокировки страницы под модальным окном.


### Слой презентера
Код презентера не будет выделен в отдельный класс, а будет размещен в основном скрипте приложения.

События:  
`'cards:change'` - выводит товары на главную страницу.  

`'card:select'`   - Выбор карточки и инициализация её просмотра.  
`'preview:changed'` - Рендер карточки и открытие её в модальном окне.  

`'basket:open'`   - При клике на иконку корзины в шапке сайта, открывается модально окно с корзиной.  
`'basket:change'` - Изменение состава корзины. В корзине рассчитывается сумма стоимости всех товаров в корзине. При нажатии на кнопку удаления товара из корзины, итог пересчитывается.

`'order:open'` - При нажатии на кнопку "Оформить заказ" открывается форма выбора способа оплаты и адреса доставки.  
`'contacts:open'` - При нажатии на кнопку "Далее" открывается Contacts форма указания контактов.  
`/^order\..*:change/` - Валидация полей формы заказа.  
`/^contacts\..*:change/` - Валидация полей формы контактов.  
`'formErrors:change'` - Проверка валидности формы.  
  
`'order:submit'` - При нажатии на кнопку "Далее" закрывает форму заказа и открывает форму контактов.  
`'contacts:submit'` - При нажатии на кнопку "Олатить" отправляет данные о заказе на сервер.  
`'success:open'` - При успешном ответе с сервера о принятом заказе открывается модальное окно об успешном оформлении заказа.  

`'modal:open'` - открытие модального окна.  
`'modal:close'` - закрытие модального окна.


