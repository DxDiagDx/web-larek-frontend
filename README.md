# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Каталог товаров

```
interface ICardCatalog {
    cards: ICard[];
    preview: string | null;
}
```

Товар

```
interface ICard {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```

Заказ

```
interface IOrder {
    payment: string;
    email: string;
    phone: string;
    address: string;
    total: number;
    items: ICard[];
}
```

Корзина

```
interface IBasket {
    basketList: TCardCompact[];
    getTotal(): number;
}
```

Тип товара для отображения в корзине

```
type TCardCompact = Pick<ICard, 'title' | 'price'>
```

Данные формы способа оплаты и адреса доставки

```
interface ICheckOut {
    checkValidation(data: Record<keyof TCheckOut, string>): boolean;
}
```

Данные формы контактов

```
interface IContacts {
    checkValidation(data: Record<keyof TContacts, string>): boolean;
}
```

Тип данных для формы способа оплаты и адреса доставки

```
type TCheckOut = Pick<IOrder, 'payment' | 'address'>
```

Тип данных для формы контактов

```
type TContacts = Pick<IOrder, 'email' | 'phone'>
```


## Архитектура приложения

Код разделён на слои, согласно MVP:
- слой отображения отвечает за отображение данных на странице
- слой данных отвечает за их хранение и изменение
- презентер отвечает за связь между слоем отображения и слоем данных

### Базовый код

#### Класс Api
Содержит базовую логику отправки запросов. В конструктор передаётся базовый адрес сервера и опциональный объект с заголовками запроса.

Методы:
- `get` - выполяет GET запрос на переданный эндпоинт и возвращает промис с объектом
- `post` - принимает объект с данными, которые будут отправлены в JSON в теле запроса, и отправялет эти данные на эндпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод может быть переопределён заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:
- `on` - подписка на события
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой иницициализируется требуемое в параметрах событие

### Слой данных

#### Класс PageData
Класс отвечает за логику работы с данными.

Поля класса:
- `cards: ICard[]` - список товаров
- `basket: IBasket` - список товаров в корзине и общая сумма заказа
- `order: IOrder` - информация о заказе

Конструктор принимает в качестве параметра:
- `events: IEvents` - брокер событий

Методы класса:
- `addCardToBasket(): void` - добавить товар в корзину
- `removeCardFromBasket(): void` - удалить товар из корзины
- `inBasket(item: ICard)` - возвращает товары, которые добавлены в корзину
- `clearBasket(): void` - очищает корзину


### Слой отображения

#### Класс Modal
Класс отвечает за отображения контента в модальном окне.
У каждого контента есть свой шаблон. 
Контент передаётся методу `render`, как параметр.

Поля класса
- `buttonClose: HTMLElement` - кнопка закрытия модального окна
- `content: HTMLElement` - блок для контента модального окна

Конструктор класса принимает два параметра:
- `container: HTMLElement` - контейнер модального окна
- `events: IEvents` - брокер событий

Методы:
- `open(): void` - открыть модальное окно
- `close(): void` - закрыть модальное окно
- `render(data: HTMLElement): HTMLElement` - рендер контента для отображения в модальном окне


#### Класс Card
Класс Card отвечает за отображение:
- в галерее товаров на главной странице
- в модальном окне с подробной информацией
- в списке товаров в корзине

Поля класса:
- `category`
- `title`
- `description`
- `image`
- `price`

Конструктор класса принимает два параметра:
- `container: HTMLElement` - шаблон карточки 
- `events: EventEmitter` - обработчик клика, соответствующий различным шаблонам

Методы - сеттеры и геттеры для заполнения полей карточки


#### Класс Basket
Класс Basket отвечает за отображение корзины.

Поля:
- `list: HTMLElement` - список товаров в корзине
- `total: number` - общая стоимость товаров в корзине
- `button: HTMLElement` - кнопка действия "Купить" или "Удалить"

Конструктор класса принимает два параметра:
- `container: HTMLElement` - шаблон корзины 
- `events: IEvents` - брокер событий

Методы - сеттеры и геттеры для заполнения полей класса.



#### Класс Order
Первый шаг оформления товара. Отображает форму в модальном окне.
Отображает элементы для указания способы оплаты и адреса доставки.

Поля класса:
- `payment` - способ оплаты
- `address` - адрес доставки

Конструктор класса принимает два параметра:
- `container: HTMLElement` - шаблон формы #order
- `events: IEvents` - брокер событий

Методы - сеттеры для заполнения полей класса.


#### Класс Contacts
Второй шаг оформления товара. Отображает форму в модальном окне.
Отображает инпуты для указания email и телефона.

Поля класса:
- `email: string`
- `phone: string`

Конструктор класса принимает два параметра:
- `container: HTMLElement` - контейнер, в котором будет отображаться контент
- `events: IEvents` - брокер событий

Методы - сеттеры для заполнения полей класса.



#### Класс Form
Класс расширяет классы Order и Contacts, добавляя в них проверку правильности заполнения форм.

Поля класса:
- `errors: HTMLElement` - информация об ошибках

Конструктор класса принимает два параметра:
- `container: HTMLElement` - контейнер, в котором будет отображаться контент
- `events: IEvents` - брокер событий

Методы - сеттер для заполнения поля errors.


#### Класс Success
Отвечает за отображение информации об успешном оформлении заказа.

Поля:
- `total: HTMLElement` - информация о сумме заказа
- 

Конструктор принимает два параметра:
- `container: HTMLElement` - контейнер, в котором будет отображаться контент
- `events: IEvents` - брокер событий

Методы - сеттер для заполнения поля total.


#### Класс Page
Класс отвечает за отображение на главной странице списка товаров, счётчика количества товаров в корзине и иконки корзины, слушающей клик.

Поля класса:
- `gallery: HTMLElement` - список товаров
- `counter: HTMLElement` - количество товаров в корзине.
- `basket: HTMLElement` - иконка корзины, при нажатии на которую открывается модальное окно с содержимым корзины

Конструктор класса принимает два параметра:
- `container: HTMLElement` - контейнер, в котором будет отображаться контент
- `events: IEvents` - брокер событий

Методы:
- `set counter(value: number)` - количество товаров в корзине
- `set gallery(items: HTMLElement[])` - список товаров


### Слой презентера
Код презентера не будет выделен в отдельный класс, а будет размещен в основном скрипте приложения.

События:
'cards:change' - изменение списка товаров

'card:select'   - При клике на карточку товара, она открывается в модальном окне.
'card:basket-in'  - При нажатии на кнопку "Купить" меняется свойство товара inBasket название кнопки на "Удалить"
'card:basket-out' - Если товар уже есть в корзине - при нажатии на кнопку "Удалить" меняется свойство товара inBasket и название кнопки на "Купить"

'basket:open'   - При клике на иконку корзины в шапке сайта, открывается модально окно с корзиной. В корзине отображаются товары, у которых свойство inBasket = True.
'basket:change' - В корзине рассчитывается сумма стоимости всех товаров в корзине. При нажатии на кнопку удаления товара из корзины, корзина пересчитывается.

'order:open' - При нажатии на кнопку "Оформить заказ" открывается форма выбора способа оплаты и адреса доставки.
'contacts:open' - При нажатии на кнопку "Далее" открывается Contacts форма указания контактов.

'order:submit' - При нажатии на кнопку "Оплатить" отправляет запрос на сервер с заказом 
'success:open' - При успешном ответе с сервера о принятом заказе открывается Success модальное окно.


